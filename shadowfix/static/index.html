<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SHADOWFIX ‚Äî Deepfake Detector</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:        #080b12;
      --panel:     #0e131f;
      --border:    #1a2235;
      --accent:    #00e5ff;
      --danger:    #ff3b5c;
      --warn:      #ffb300;
      --safe:      #00e676;
      --text:      #e0e8ff;
      --muted:     #4a5578;
      --glow-c:    rgba(0,229,255,0.18);
    }

    html, body { height: 100%; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ‚îÄ‚îÄ Grid background ‚îÄ‚îÄ */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(0,229,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,229,255,0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    header {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 14px;
      padding: 36px 24px 12px;
      position: relative;
      z-index: 1;
    }
    .logo-icon {
      width: 44px; height: 44px;
      background: linear-gradient(135deg, var(--accent), #7c4dff);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px;
      box-shadow: 0 0 24px rgba(0,229,255,0.35);
    }
    h1 {
      font-size: 2rem;
      font-weight: 900;
      letter-spacing: 0.12em;
      background: linear-gradient(90deg, var(--accent), #7c4dff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .tagline {
      text-align: center;
      color: var(--muted);
      font-size: 0.85rem;
      letter-spacing: 0.06em;
      margin-bottom: 40px;
      text-transform: uppercase;
      position: relative; z-index: 1;
    }

    /* ‚îÄ‚îÄ Main card ‚îÄ‚îÄ */
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 36px;
      width: 100%;
      max-width: 520px;
      position: relative;
      z-index: 1;
      box-shadow: 0 0 60px rgba(0,0,0,0.6), 0 0 0 1px var(--border);
    }
    .card::before {
      content: '';
      position: absolute;
      inset: -1px;
      border-radius: 25px;
      padding: 1px;
      background: linear-gradient(135deg, rgba(0,229,255,0.2), transparent 60%, rgba(124,77,255,0.15));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events: none;
    }

    /* ‚îÄ‚îÄ Mode toggle ‚îÄ‚îÄ */
    .mode-toggle {
      display: flex;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 4px;
      margin-bottom: 28px;
      gap: 4px;
    }
    .mode-toggle button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 9px;
      background: transparent;
      color: var(--muted);
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 0.04em;
    }
    .mode-toggle button.active {
      background: linear-gradient(135deg, rgba(0,229,255,0.15), rgba(124,77,255,0.15));
      color: var(--accent);
      box-shadow: 0 0 0 1px rgba(0,229,255,0.25);
    }

    /* ‚îÄ‚îÄ Drop zone ‚îÄ‚îÄ */
    .dropzone {
      border: 2px dashed var(--border);
      border-radius: 16px;
      padding: 40px 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.25s;
      position: relative;
      background: var(--bg);
    }
    .dropzone:hover, .dropzone.dragover {
      border-color: var(--accent);
      background: rgba(0,229,255,0.04);
      box-shadow: 0 0 24px var(--glow-c);
    }
    .dropzone input[type="file"] {
      position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
    }
    .drop-icon { font-size: 2.8rem; margin-bottom: 12px; display: block; }
    .drop-title {
      font-size: 0.95rem; font-weight: 600; margin-bottom: 6px; color: var(--text);
    }
    .drop-hint { font-size: 0.78rem; color: var(--muted); }

    /* ‚îÄ‚îÄ Preview ‚îÄ‚îÄ */
    #preview-wrap {
      display: none;
      margin-top: 18px;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      max-height: 220px;
    }
    #preview-img { width: 100%; display: block; object-fit: cover; max-height: 220px; border-radius: 12px; }
    #preview-video { width: 100%; display: block; border-radius: 12px; max-height: 220px; }
    .preview-badge {
      position: absolute; top: 10px; right: 10px;
      background: rgba(8,11,18,0.85);  backdrop-filter: blur(6px);
      border: 1px solid var(--border); border-radius: 8px;
      font-size: 0.72rem; font-weight: 700; color: var(--muted);
      padding: 4px 10px; letter-spacing: 0.06em;
    }
    #file-name {
      margin-top: 10px; font-size: 0.78rem; color: var(--muted);
      font-family: 'JetBrains Mono', monospace;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;
    }

    /* ‚îÄ‚îÄ Analyse button ‚îÄ‚îÄ */
    #analyse-btn {
      display: none;
      width: 100%;
      margin-top: 22px;
      padding: 14px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, #00c8e0, #7c4dff);
      color: #fff;
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.15s;
      box-shadow: 0 4px 20px rgba(0,229,255,0.25);
    }
    #analyse-btn:hover { opacity: 0.92; transform: translateY(-1px); }
    #analyse-btn:active { transform: translateY(0); }
    #analyse-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

    /* ‚îÄ‚îÄ Spinner ‚îÄ‚îÄ */
    .spinner-wrap {
      display: none; flex-direction: column; align-items: center;
      gap: 14px; padding: 32px 0; text-align: center;
    }
    .spinner {
      width: 48px; height: 48px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner-label { font-size: 0.85rem; color: var(--muted); animation: pulse 2s ease-in-out infinite; }
    @keyframes pulse { 0%,100%{opacity:0.5} 50%{opacity:1} }

    /* ‚îÄ‚îÄ Result ‚îÄ‚îÄ */
    #result-wrap { display: none; margin-top: 24px; text-align: center; }

    .verdict {
      font-size: 3.2rem;
      font-weight: 900;
      letter-spacing: 0.12em;
      margin-bottom: 8px;
      animation: verdict-pop 0.4s cubic-bezier(.175,.885,.32,1.275);
    }
    @keyframes verdict-pop {
      from { transform: scale(0.6); opacity: 0; }
      to   { transform: scale(1);   opacity: 1; }
    }
    .verdict.fake { color: var(--danger); text-shadow: 0 0 30px rgba(255,59,92,0.5); }
    .verdict.real { color: var(--safe);  text-shadow: 0 0 30px rgba(0,230,118,0.5); }

    /* ‚îÄ‚îÄ Risk ring ‚îÄ‚îÄ */
    .risk-ring-wrap {
      display: flex; justify-content: center; align-items: center;
      margin: 20px 0;
      position: relative;
    }
    .risk-ring-wrap svg { transform: rotate(-90deg); }
    .ring-bg { fill: none; stroke: var(--border); stroke-width: 8; }
    .ring-fill {
      fill: none; stroke-width: 8;
      stroke-linecap: round;
      stroke-dasharray: 283;
      stroke-dashoffset: 283;
      transition: stroke-dashoffset 1.2s cubic-bezier(.25,.46,.45,.94),
                  stroke 0.4s ease;
    }
    .ring-label {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      text-align: center; pointer-events: none;
    }
    .ring-pct { font-size: 1.7rem; font-weight: 900; font-family: 'JetBrains Mono', monospace; }
    .ring-sub { font-size: 0.72rem; color: var(--muted); letter-spacing: 0.08em; text-transform: uppercase; margin-top: 2px; }

    /* ‚îÄ‚îÄ Risk badge ‚îÄ‚îÄ */
    .risk-badge {
      display: inline-block;
      padding: 6px 20px;
      border-radius: 100px;
      font-size: 0.85rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      border: 1px solid;
    }
    .risk-badge.low    { color: var(--safe);   border-color: var(--safe);   background: rgba(0,230,118,0.08); }
    .risk-badge.medium { color: var(--warn);   border-color: var(--warn);   background: rgba(255,179,0,0.08); }
    .risk-badge.high   { color: var(--danger); border-color: var(--danger); background: rgba(255,59,92,0.08); }

    /* ‚îÄ‚îÄ Scan lines animation for result ‚îÄ‚îÄ */
    #result-wrap.active::after {
      content: '';
      position: absolute; left: 0; right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
      animation: scan 1.5s ease-out forwards;
      pointer-events: none;
    }
    @keyframes scan { from{top:0;opacity:1} to{top:100%;opacity:0} }

    /* ‚îÄ‚îÄ Reset ‚îÄ‚îÄ */
    #reset-btn {
      margin-top: 18px;
      background: none;
      border: 1px solid var(--border);
      color: var(--muted);
      padding: 9px 24px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 0.82rem;
      transition: all 0.2s;
    }
    #reset-btn:hover { border-color: var(--accent); color: var(--accent); }

    /* ‚îÄ‚îÄ Error ‚îÄ‚îÄ */
    .error-msg {
      display: none; margin-top: 16px;
      background: rgba(255,59,92,0.08);
      border: 1px solid rgba(255,59,92,0.3);
      border-radius: 10px; padding: 12px 16px;
      font-size: 0.83rem; color: var(--danger);
    }

    /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
    footer {
      margin-top: 32px; margin-bottom: 24px;
      font-size: 0.75rem; color: var(--muted);
      text-align: center; z-index: 1; position: relative;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo-icon">üõ°Ô∏è</div>
    <h1>SHADOWFIX</h1>
  </header>
  <p class="tagline">AI-Powered Deepfake Detection</p>

  <div class="card">
    <!-- Mode toggle -->
    <div class="mode-toggle">
      <button class="active" id="btn-image" onclick="setMode('image')">üñºÔ∏è &nbsp;Image</button>
      <button id="btn-video" onclick="setMode('video')">üé¨ &nbsp;Video</button>
    </div>

    <!-- Drop zone -->
    <div class="dropzone" id="dropzone">
      <input type="file" id="file-input" accept="image/*" />
      <span class="drop-icon" id="drop-icon">üìÅ</span>
      <p class="drop-title" id="drop-title">Drop your image here</p>
      <p class="drop-hint" id="drop-hint">or click to browse ¬∑ JPEG, PNG, WebP, BMP</p>
    </div>

    <!-- Preview -->
    <div id="preview-wrap">
      <img id="preview-img" src="" alt="Preview" style="display:none" />
      <video id="preview-video" src="" muted playsinline loop style="display:none"></video>
      <span class="preview-badge" id="preview-badge">IMAGE</span>
    </div>
    <p id="file-name"></p>

    <!-- Analyse button -->
    <button id="analyse-btn" onclick="analyse()">‚ö° ANALYSE</button>

    <!-- Error -->
    <div class="error-msg" id="error-msg"></div>

    <!-- Spinner -->
    <div class="spinner-wrap" id="spinner-wrap">
      <div class="spinner"></div>
      <p class="spinner-label" id="spinner-label">Scanning with AI‚Ä¶</p>
    </div>

    <!-- Result -->
    <div id="result-wrap" style="position:relative">
      <div class="verdict" id="verdict-text">FAKE</div>

      <div class="risk-ring-wrap">
        <svg width="120" height="120" viewBox="0 0 100 100">
          <circle class="ring-bg" cx="50" cy="50" r="45"/>
          <circle class="ring-fill" id="ring-fill" cx="50" cy="50" r="45"/>
        </svg>
        <div class="ring-label">
          <div class="ring-pct" id="ring-pct">0%</div>
          <div class="ring-sub">Risk Score</div>
        </div>
      </div>

      <div class="risk-badge" id="risk-badge">‚Äî</div>

      <br/>
      <button id="reset-btn" onclick="reset()">‚Ü∫ &nbsp;Analyse Another</button>
    </div>
  </div>

  <footer>SHADOWFIX v2.0 &nbsp;¬∑&nbsp; CPU inference &nbsp;¬∑&nbsp; No data stored</footer>

  <script>
    let currentMode = 'image';
    let selectedFile = null;

    // ‚îÄ‚îÄ Mode switching ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function setMode(mode) {
      currentMode = mode;
      document.getElementById('btn-image').classList.toggle('active', mode === 'image');
      document.getElementById('btn-video').classList.toggle('active', mode === 'video');

      const input = document.getElementById('file-input');
      const icon  = document.getElementById('drop-icon');
      const title = document.getElementById('drop-title');
      const hint  = document.getElementById('drop-hint');
      const badge = document.getElementById('preview-badge');

      if (mode === 'image') {
        input.accept = 'image/*';
        icon.textContent  = 'üìÅ';
        title.textContent = 'Drop your image here';
        hint.textContent  = 'or click to browse ¬∑ JPEG, PNG, WebP, BMP';
        badge.textContent = 'IMAGE';
      } else {
        input.accept = 'video/*';
        icon.textContent  = 'üé¨';
        title.textContent = 'Drop your video here';
        hint.textContent  = 'or click to browse ¬∑ MP4, MOV, AVI, WebM ¬∑ max 100 MB';
        badge.textContent = 'VIDEO';
      }
      reset(); // clear selection when switching
    }

    // ‚îÄ‚îÄ File selection ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const fileInput = document.getElementById('file-input');
    const dropzone  = document.getElementById('dropzone');

    fileInput.addEventListener('change', () => handleFile(fileInput.files[0]));

    dropzone.addEventListener('dragover',  e => { e.preventDefault(); dropzone.classList.add('dragover'); });
    dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
    dropzone.addEventListener('drop', e => {
      e.preventDefault(); dropzone.classList.remove('dragover');
      handleFile(e.dataTransfer.files[0]);
    });

    function handleFile(file) {
      if (!file) return;
      selectedFile = file;
      showPreview(file);
      document.getElementById('file-name').textContent = file.name;
      document.getElementById('analyse-btn').style.display = 'block';
      document.getElementById('result-wrap').style.display  = 'none';
      document.getElementById('error-msg').style.display    = 'none';
      document.getElementById('preview-wrap').style.display = 'block';
    }

    function showPreview(file) {
      const url = URL.createObjectURL(file);
      const img = document.getElementById('preview-img');
      const vid = document.getElementById('preview-video');
      if (currentMode === 'image') {
        img.src = url; img.style.display = 'block';
        vid.style.display = 'none'; vid.src = '';
      } else {
        vid.src = url; vid.style.display = 'block'; vid.play();
        img.style.display = 'none'; img.src = '';
      }
    }

    // ‚îÄ‚îÄ Analysis ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function analyse() {
      if (!selectedFile) return;

      const btn     = document.getElementById('analyse-btn');
      const spinner = document.getElementById('spinner-wrap');
      const errEl   = document.getElementById('error-msg');
      const resEl   = document.getElementById('result-wrap');
      const label   = document.getElementById('spinner-label');

      btn.disabled = true;
      spinner.style.display = 'flex';
      resEl.style.display   = 'none';
      errEl.style.display   = 'none';

      const tips = [
        'Scanning pixel patterns‚Ä¶',
        'Analysing facial geometry‚Ä¶',
        'Checking compression artifacts‚Ä¶',
        'Running AI inference‚Ä¶',
        'Computing risk score‚Ä¶',
      ];
      let t = 0;
      const tipInterval = setInterval(() => { label.textContent = tips[t++ % tips.length]; }, 1800);

      try {
        const form = new FormData();
        form.append('file', selectedFile);

        const endpoint = currentMode === 'image' ? '/analyze-image' : '/analyze-video';
        const res = await fetch(endpoint, { method: 'POST', body: form });

        if (!res.ok) {
          const err = await res.json().catch(() => ({ detail: 'Unknown error' }));
          throw new Error(err.detail || `Server error ${res.status}`);
        }

        const data = await res.json();
        showResult(data);
      } catch (err) {
        errEl.textContent = '‚ö†Ô∏è ' + err.message;
        errEl.style.display = 'block';
      } finally {
        clearInterval(tipInterval);
        spinner.style.display = 'none';
        btn.disabled = false;
      }
    }

    function showResult(data) {
      const prob      = data.deepfake_probability ?? data.overall_probability ?? 0;
      const riskLevel = (data.risk_level || 'LOW').toLowerCase();
      const isFake    = data.flag;

      // Verdict
      const verdictEl = document.getElementById('verdict-text');
      verdictEl.textContent = isFake ? 'FAKE' : 'REAL';
      verdictEl.className   = 'verdict ' + (isFake ? 'fake' : 'real');

      // Risk ring
      const pct    = Math.round(prob * 100);
      const circ   = 2 * Math.PI * 45;         // ‚âà 283
      const offset = circ * (1 - prob);
      const ring   = document.getElementById('ring-fill');
      const colors = { low: '#00e676', medium: '#ffb300', high: '#ff3b5c' };
      ring.style.stroke            = colors[riskLevel] || '#00e5ff';
      ring.style.strokeDashoffset  = offset;
      document.getElementById('ring-pct').textContent  = pct + '%';
      document.getElementById('ring-pct').style.color  = colors[riskLevel] || '#00e5ff';

      // Risk badge
      const badge = document.getElementById('risk-badge');
      badge.textContent  = riskLevel.toUpperCase() + ' RISK';
      badge.className    = 'risk-badge ' + riskLevel;

      document.getElementById('result-wrap').style.display = 'block';
      document.getElementById('result-wrap').classList.add('active');
      setTimeout(() => document.getElementById('result-wrap').classList.remove('active'), 1600);
    }

    function reset() {
      selectedFile = null;
      document.getElementById('file-input').value   = '';
      document.getElementById('preview-wrap').style.display = 'none';
      document.getElementById('preview-img').src    = '';
      document.getElementById('preview-video').src  = '';
      document.getElementById('preview-video').pause();
      document.getElementById('file-name').textContent      = '';
      document.getElementById('analyse-btn').style.display  = 'none';
      document.getElementById('result-wrap').style.display  = 'none';
      document.getElementById('error-msg').style.display    = 'none';
      document.getElementById('spinner-wrap').style.display = 'none';
      // reset ring
      document.getElementById('ring-fill').style.strokeDashoffset = 283;
      document.getElementById('ring-pct').textContent = '0%';
    }
  </script>
</body>
</html>
